
<template>
  <view class="container">
    <view class="top_nav">
      <view :style="{height:statusBarHeight}"></view>
      <view class="top_content">
        <view class="player">
          <image class="img" src="/static/add-one.png"></image>
        </view>
        <view class="content_btn">
          <view class="content_item">
            <text class="item_title">æœ‹å‹</text>
            <view></view>
          </view>
          <view class="content_item">
            <text class="item_title i_on">åŠ¨æ€</text>
            <view class="line_on"></view>
          </view>
        </view>
        <view class="search">
          <image class="img" src="/static/search.png"></image>
        </view>
      </view>
    </view>

    <view :style="'width: '+ windowWidth +'px; height: '+ boxStyle.height +'px;'">
      <!-- 
		 1.è¿™é‡Œçš„ swiper ä¸æ˜¯ç”¨æ¥æ§åˆ¶è§†é¢‘æ»‘åŠ¨çš„ï¼Œè€Œæ˜¯ç”¨æ¥æ§åˆ¶å·¦å³æ»‘åŠ¨çš„ï¼Œå¦‚æœä¸éœ€è¦çš„å¯ä»¥æ”¹æˆ view
		 
		 2.ä¸ºäº† è§†é¢‘æ— é™åŠ è½½ï¼Œå·²ç»æŠŠ 21 è¡Œçš„ appear å»æ‰äº†ï¼ŒåŠ ä¸Šäº† loadmore æ–¹æ³•ï¼ˆç¬¬10è¡Œï¼‰
		 
		 3.ç”±äºæ–¹æ³•æ¯”è¾ƒå¤šï¼Œå¯ä»¥é‡‡å–ä¸‹é¢çš„æ–¹å¼æŸ¥çœ‹ä»£ç ï¼š
		 ï¼ˆ1ï¼‰Macï¼šæŒ‰ä½ option é”®ï¼Œç„¶åç‚¹å‡»æ–¹æ³•åï¼Œå³å¯è·³è½¬åˆ°æ–¹æ³•
		 ï¼ˆ2ï¼‰windowsï¼šæŒ‰ä½ Alt é”®ï¼Œç„¶åé¼ æ ‡å·¦å‡»ï¼Œå³å¯è·³è½¬åˆ°æ–¹æ³•
		 -->
      <list @loadmore="getData" @scroll="scrolls" :loadmoreoffset="wHeight*3" :show-scrollbar="false" ref="listBox"
        :pagingEnabled="true" :scrollable="true">
        <!-- åˆ·æ–°æ¨¡å— -->
        <refresh class="refresh" @refresh="onrefresh" @pullingdown="onpullingdown"
          :display="refreshing ? 'show' : 'hide'">
          <loading style="background-color: #FFFFFF;">
            <image src="@/static/img/index/logins.gif"
              :style="'width: 80upx; height: 40upx; margin-top: 80upx; margin-bottom: 30upx; margin-left: '+ (windowWidth - 200) +'px;'">
            </image>
          </loading>
        </refresh>

        <!-- å¾ªç¯æ•°æ® -->
        <cell v-for="(item,i) in dataList" :key="i">
          <!-- ç”¨divæŠŠè§†é¢‘æ¨¡ç»„å¥—èµ·æ¥ -->
          <div :style="'width: '+ windowWidth +'px; height: '+ boxStyle.height +'px;'" @disappear="stop()">
            <view class="root">
              <video v-if="Math.abs(k-i)<=1" :ref="'item'+i" :id="item._id" :loop="true" :src="item.src"
                :muted="item.isplay" @play="playIngs(i)" :enable-progress-gesture="false" :page-gesture="false"
                :controls="false" :http-cache="true" :show-loading="false" :show-fullscreen-btn="false"
                :show-center-play-btn="false" :object-fit="object_fit"
                :style="'width: '+ windowWidth +'px; height: '+ boxStyle.height +'px;'"
                @timeupdate="timeupdate($event,i)"></video>
              <!-- è¿™é‡Œæ˜¯å°é¢ -->
              <!-- <image v-if="!item.playIng" :src="item.src+'?x-oss-process=video/snapshot,t_100,f_jpg'" :mode="mode"
                 :style="'width: '+ windowWidth +'px; height: '+ (wHeight - deleteHeight) +'px; position: absolute;'"
                >
              </image> -->
              <!-- 
						mode: å›¾ç‰‡è£å‰ªã€ç¼©æ”¾çš„æ¨¡å¼
						mode æœ‰ 14 ç§æ¨¡å¼ï¼Œå…¶ä¸­ 5 ç§æ˜¯ç¼©æ”¾æ¨¡å¼ï¼Œ9 ç§æ˜¯è£å‰ªæ¨¡å¼ã€‚
						https://uniapp.dcloud.io/component/image
						 -->
            </view>
            <!-- ç›´æ¥ç”¨ view å°±è¡Œäº†ï¼Œä¸€æ ·æ˜¯å¯ä»¥è¦†ç›–åŸç”Ÿç»„ä»¶çš„ -->
            <!-- è¿™ä¸ªæ˜¯æš‚åœæ—¶å‡ºç°çš„å›¾æ ‡ -->
            <view class="videoHover" @click="tapVideoHover(item.state,$event)" :style="boxStyle">
              <image v-if="item.state=='pause'" class="playState" src="@/static/img/index/play.png"></image>
            </view>
            <view class="userInfo" v-if="!dataList[k].isShowProgressBarTime">
              <!-- 1.å¤´åƒ -->
              <image v-if="item.isShowProgressBarTime == false" @click="tozuozhe" class="userAvatar" :src="item.href"
                mode="aspectFill"></image>
              <!-- 2.ç‚¹èµ -->
              <view v-if="item.isShowProgressBarTime == false" @click="cLike(item.like);"
                style="opacity: 0.9; margin-top: 17px;">
                <image v-if="item.like" src="@/static/img/index/xin.png"
                  style="width: 40px; height: 40px; position: absolute; right: 6px;"></image>
                <image v-if="!item.like" src="@/static/img/index/xin-2.png"
                  style="width: 40px; height: 40px; position: absolute; right: 6px;"></image>
                <text
                  style="color: #FFFFFF; margin-top: 5px; font-size: 14px; text-align: center; margin-top: 40px; font-weight: bold;"
                  :class="{'likeNumActive':item.like}">{{item.like_n}}</text>
              </view>
              <!-- 3.è¯„è®º -->
              <view v-if="item.isShowProgressBarTime == false" class="comment" @click="toComment(i)"
                style="opacity: 0.9; margin-top: 17px;">
                <image src="@/static/img/index/liaotian-2.png"
                  style="width: 35px; height: 35px; position: absolute; right: 7px;"></image>
                <text
                  style="color: #FFFFFF; margin-top: 5px; font-size: 14px; font-weight: bold; text-align: center; margin-top: 40px;">{{item.sms_n}}</text>
              </view>
              <!-- 4.åˆ†äº« -->
              <view v-if="item.isShowProgressBarTime == false" @click="share" style="opacity: 0.9; margin-top: 17px;">
                <image src="@/static/img/index/share-fill.png"
                  style="width: 40px; height: 40px; position: absolute; right: 5px;"></image>
                <text
                  style="color: #FFFFFF; margin-top: 5px; font-size: 14px; text-align: center; font-weight: bold; margin-top: 40px;">åˆ†äº«</text>
              </view>
            </view>
            <!-- æœ€åº•ä¸‹çš„æ–‡å­—éƒ¨åˆ† -->
            <view class="content" :style="'bottom:' + 20 + 'px;'" v-if="!dataList[k].isShowProgressBarTime">
              <text class="userName" :style="'width: '+ (windowWidth - 90) +'px;'">{{item.title}}</text><!-- i={{i}} -->
              <text class="words" :style="'width: '+ (windowWidth - 90) +'px;'">{{item.msg}}-{{k+1}}</text>
              <!-- k={{k}} -->
            </view>
            <!-- 1.è§†é¢‘é¢„è§ˆæ—¶çš„å›¾ç‰‡ï¼Œcurrenttimesï¼šå°±æ˜¯è·å–å½“å‰æ»‘å—çš„æ—¶é—´ç‚¹ï¼Œå¦‚æœä¸éœ€è¦ï¼Œå¯ä»¥æ³¨é‡Šæ‰ -->
            <!-- 2.å¦‚æœä½¿ç”¨ä¸‹é¢çš„è§†é¢‘é¢„è§ˆçš„è¯è¦æ³¨æ„çš„æ˜¯è§†é¢‘é“¾æ¥æœ€å¥½æ˜¯é˜¿é‡Œäº‘ä¸Šçš„ï¼Œå› ä¸º
							https://xxxxxxxxx.mp4?x-oss-process=video/snapshot,t_1000,f_jpg
							è¿™ä¸ªæ˜¯é˜¿é‡Œäº‘çš„ä¸œè¥¿ï¼Œè‡³äºå…¶ä»–çš„è§†é¢‘æˆªå¸§æˆ‘è¿˜æ²¡æœ‰è¯•è¿‡ã€‚
							-->
            <!-- 3.é˜¿é‡Œäº‘è§†é¢‘æˆªå¸§åœ°å€ï¼šhttps://help.aliyun.com/document_detail/64555.html -->
            <image v-if="item.isShowimage == true"
              :src="item.src+'?x-oss-process=video/snapshot,t_'+ currenttimes +'000,f_jpg'" mode="aspectFill"
              :style="'width: 120upx; height: 160upx; border-radius: 10upx; position: absolute; bottom: '+ (ProgressBarBottom + 90) +'upx; left: '+ (currentPositions - 15) +'px;'">
            </image>
          </div>
        </cell>
      </list>
      <!-- 1.æ³¨æ„ï¼šè¿›åº¦æ¡è¿™ç±»æ‹–æ‹½çš„ä¸œè¥¿ä¸èƒ½æ”¾è¿›block\cellè¿™äº›å¾ªç¯ä½“ä¸­çš„ï¼Œè¦ä¸ç„¶touchmoveæ–¹æ³•ä¼šæ•æ‰æœ‰è¯¯ -->
      <view v-if="dataList[k].isShowProgressBarTime == true"
        :style="'position: absolute; bottom: '+ (ProgressBarBottom + 30) +'upx; left: '+ (windowWidth*2 - 550) +'upx;'">
        <text style="font-size: 18px; color: #F1F1F1;">{{changeTime}} / {{videoTimes}}</text>
      </view>
      <!-- è¿™é‡Œå°±æ˜¯è¿›åº¦æ¡äº†ï¼šçº¯æ‰‹å·¥è¿›åº¦æ¡ï¼Œè°ƒæ•´ä½ç½®çš„è¯å°±æŠŠä»–ä»¬çš„ bottom æ”¹æˆä¸€ä¸‹å°±è¡Œäº† -->
      <view v-if="isDragging == false" @touchmove="touchmove" @touchend="touchend" @touchstart="touchstart"
        :style="'position: absolute; bottom: '+ (ProgressBarBottom - 40) +'upx; left: 0;'">
        <!-- 1.è¿™ä¸€æ­¥å¿…é¡»åŠ ï¼Œä¸ºäº†é€‚é…ä½ç«¯æœºå‹ -->
        <text :style="'width: '+ windowWidth +'px; opacity: 0;'">.</text>
        <!-- 2.è¿™æ˜¯æœªåŠ è½½çš„æ—¶çš„å³è¾¹çš„ç°è‰²éƒ¨åˆ† -->
        <view
          :style="'width: '+ windowWidth +'px; height: 4upx; background-color: #C8C7CC; position: absolute; bottom: '+ ProgressBarBottom +'upx; opacity: '+ ProgressBarOpacity +';'">
        </view>
        <!-- 3.è¿™é‡Œæˆ‘é‡‡ç”¨çš„åˆ†ç¦»å¼åŠæ³•ï¼šå°±æ˜¯è®©æ»‘åŠ¨æ ·å¼å’Œä¸æ»‘åŠ¨çš„æ ·å¼åˆ†å¼€ï¼Œè¿™æ ·ç›¸äº’ä¸å¹²æ‰°ï¼Œå¯ä»¥é¿å…è¿›åº¦æ¡é—ªåŠ¨çš„é—®é¢˜ -->
        <!-- 4.æ³¨æ„ï¼šisShowProgressBarTime åŠ å…¥äº†è¿”å›æ•°æ®ä¸­ -->
        <view v-if="dataList[k].isShowProgressBarTime == false"
          :style="'width: '+ (currentPosition) +'px; height: 4upx; background-color: #FFFFFF; position: absolute; bottom: '+ ProgressBarBottom +'upx; left: 0; opacity: '+ (ProgressBarOpacity - 0.1) +';'">
        </view>
        <view v-if="dataList[k].isShowProgressBarTime == true"
          :style="'width: '+ (currentPositions) +'px; height: 8upx; background-color: #FFFFFF; position: absolute; bottom: '+ ProgressBarBottom +'upx; left: 0; opacity: '+ (ProgressBarOpacity + 0.05) +';'">
        </view>
        <view v-if="dataList[k].isShowProgressBarTime == false"
          :style="'width: 4px; height: 4px; background-color: #FFFFFF; border-radius: 10px; position: absolute; bottom: '+ (ProgressBarBottom - 2) +'upx; left: '+ (currentPosition) +'px; opacity: '+ ProgressBarOpacity +';'">
        </view>
        <view v-if="dataList[k].isShowProgressBarTime == true"
          :style="'width: '+ dotWidth +'px; height: '+ dotWidth +'px; background-color: #FFFFFF; border-radius: 10px; position: absolute; bottom: '+ (ProgressBarBottom - 5) +'upx; left: '+ (currentPositions - 5) +'px; opacity: '+ ProgressBarOpacity +';'">
        </view>
      </view>
    </view>
  </view>
</template>
<script>
  import userList from './data.js' //è¿™ä¸ªæ˜¯å‡æ•°æ®
  export default {
    data() {
      return {
        //ä¸‹é¢æ‰“ğŸŒŸå·çš„æ˜¯å¿…é¡»è¦çš„åŸºç¡€å­—æ®µ
        //ä¸‹é¢æ‰“ğŸ’—å·çš„æ˜¯æ‹¥æœ‰æ»‘åŠ¨æ¡çš„å¿…é¡»å­—æ®µ
        dataList: [], //ç”¨äºæ•°æ®å¾ªç¯çš„åˆ—è¡¨ğŸŒŸğŸ’—
        wHeight: 0, //è·å–çš„å±å¹•é«˜åº¦ğŸŒŸğŸ’—
        boxStyle: { //è§†é¢‘ï¼Œå›¾ç‰‡å°é¢æ ·å¼ğŸŒŸğŸ’—
          'height': 0,
          'width': 0,
        },
        k: 0, //é»˜è®¤ä¸º0ğŸŒŸğŸ’—
        playIngIds: [], //æ­£åœ¨æ’­æ”¾çš„è§†é¢‘idåˆ—é˜Ÿï¼Œåˆ—é˜Ÿç”¨äºå¤„ç†æ»‘åŠ¨è¿‡å¿«å¯¼è‡´çš„è·³é¢‘é—®é¢˜ğŸŒŸğŸ’—
        ready: false, //å¯å¿½ç•¥
        isDragging: false, //falseä»£è¡¨åœæ­¢æ»‘åŠ¨ğŸŒŸğŸ’—
        refreshing: true, //ç”¨äºä¸‹æ‹‰åˆ·æ–°ğŸŒŸğŸ’—
        windowWidth: 0, //è·å–å±å¹•å®½åº¦ğŸŒŸğŸ’—
        dex: [0, 0], //ç”¨äºåˆ¤æ–­æ˜¯ä¸Šæ»‘è¿˜æ˜¯ä¸‹æ»‘ï¼Œç¬¬ä¸€ä¸ªå­˜æ—§å€¼ï¼Œç¬¬äºŒä¸ªå­˜æ–°å€¼ã€ç›®å‰åœ¨1.0.7å·²ç»åºŸå¼ƒã€‘
        currents: 0, //ç”¨äºå·¦å³æ»‘åŠ¨ï¼Œ0ä»£è¡¨è§†é¢‘ç•Œé¢ï¼Œ1ä»£è¡¨å³æ»‘ç•Œé¢ğŸŒŸğŸ’—
        platform: '', //ç”¨äºè·å–æ“ä½œç³»ç»Ÿï¼šiosã€androidğŸŒŸğŸ’—
        playIng: false, //ç”¨äºè§†é¢‘åˆå§‹åŒ–æ—¶æ˜¯å¦æ’­æ”¾ï¼Œé»˜è®¤ä¸æ’­æ”¾ğŸŒŸğŸ’—
        videoTime: '', //è§†é¢‘æ€»æ—¶é•¿ï¼Œè¿™ä¸ªä¸»è¦ç”¨æ¥æˆªå–æ—¶é—´æ•°å€¼ğŸ’—
        videoTimes: '', //è§†é¢‘æ—¶é•¿ï¼Œç”¨è¿™ä¸ªæ¥è·å–æ—¶é—´å€¼ï¼Œä¾‹å¦‚ï¼š00:30è¿™ä¸ªæ—¶é—´å€¼ğŸ’—
        changeTime: '', //æ˜¾ç¤ºæ»‘åŠ¨è¿›åº¦æ¡æ—¶å˜åŒ–çš„æ—¶é—´ğŸ’—
        isShowimage: false, //æ˜¯å¦æ˜¾ç¤ºå°é¢ã€1.0.4å·²åºŸå¼ƒï¼Œä½†æ˜¯æ„æ€éœ€è¦è®°ä½ã€‘
        currenttimes: 0, //å½“å‰æ—¶é—´ğŸ’—
        isShowProgressBarTime: false, //æ˜¯å¦æ‹–åŠ¨è¿›åº¦æ¡ï¼Œå¦‚æœæ‹–åŠ¨ï¼ˆtrueï¼‰åˆ™æ˜¾ç¤ºè¿›åº¦æ¡æ—¶é—´ï¼Œå¦åˆ™ä¸æ˜¾ç¤ºï¼ˆfalseï¼‰ã€1.0.4å·²åºŸå¼ƒï¼Œä½†æ˜¯æ„æ€éœ€è¦è®°ä½ã€‘
        ProgressBarOpacity: 0.7, //è¿›åº¦æ¡ä¸æ‹–åŠ¨æ—¶çš„é»˜è®¤å€¼ï¼Œå°±æ˜¯é€æ˜çš„ğŸ’—
        dotWidth: 0, //æ’­æ”¾çš„å°åœ†ç‚¹ï¼Œé»˜è®¤æ²¡æœ‰ğŸ’—
        deleteHeight: 0, //æµ‹è¯•é«˜åº¦ğŸŒŸğŸ’—
        percent: 0, //ç™¾åˆ†å°æ•°ğŸ’—
        currentPosition: 0, //æ»‘å—å½“å‰ä½ç½®ğŸ’—//2.0å·²å¼ƒç”¨ï¼Œç°å·²ç”¨äºåç«¯å‚æ•°
        currentPositions: 0, //æ»‘å—å½“å‰ä½ç½®çš„å‰¯æœ¬ğŸ’—//2.0å·²å¼ƒç”¨ï¼Œç°å·²ç”¨äºåç«¯å‚æ•°
        newTime: 0, //è·Ÿæ‰‹æ»‘åŠ¨åçš„æœ€æ–°æ—¶é—´ğŸ’—
        timeNumber: 0, //ğŸŒŸğŸ’—
        ProgressBarBottom: 20, //è¿›åº¦æ¡ç¦»åº•éƒ¨çš„è·ç¦»ğŸ’—
        object_fit: 'fill', //è§†é¢‘æ ·å¼é»˜è®¤åŒ…å«ğŸŒŸğŸ’—
        mode: 'aspectFit', //å›¾ç‰‡å°é¢æ ·å¼ğŸŒŸğŸ’—
        timeout: "", //ğŸŒŸç”¨æ¥é˜»æ­¢ setTimeout()æ–¹æ³•
        voice: "", //ğŸŒŸç”¨æ¥é˜»æ­¢ setTimeout()æ–¹æ³•
        oldVideo: "",
        statusBarHeight: 0,
      }
    },
    watch: {
      k(k, old_k) { //ç›‘å¬ k å€¼çš„å˜åŒ–ï¼Œå¯ä»¥æ§åˆ¶è§†é¢‘çš„æ’­æ”¾ä¸æš‚åœ
        console.log(k)
        this.dataList[old_k].state = 'stop' //å¦‚æœæ˜¯è¢«æ»‘èµ°çš„è§†é¢‘ï¼Œå°±åœæ­¢æ’­æ”¾
        this.dataList[old_k].playIng = false //å¦‚æœè§†é¢‘æš‚åœï¼Œå°±åŠ è½½å°é¢
        this.dataList[old_k].isplay = true
        uni.createVideoContext(this.dataList[old_k]._id, this).play()
        clearTimeout(this.oldVideo)
        this.oldVideo = setTimeout(() => {
          uni.createVideoContext(this.dataList[old_k]._id, this).seek(0)
          uni.createVideoContext(this.dataList[old_k]._id, this).pause()
          console.log('é¢„ç•™ç¬¬' + (old_k + 1) + 'ä¸ªè§†é¢‘ï¼š' + this.dataList[old_k]._id)
        }, 500)
        // 2.0ç‰ˆæœ¬å·²ç»å»æ‰äº†ä¸‹é¢è¿™ä¸€å¥ï¼Œè§†é¢‘ä¸ç”¨æš‚åœï¼Œåªéœ€è¦æŠŠå£°éŸ³ç¦æ­¢å°±è¡Œ
        // uni.createVideoContext(this.dataList[old_k]._id + '' + old_k,this).stop()//å¦‚æœè§†é¢‘æš‚åœï¼Œé‚£ä¹ˆæ—§è§†é¢‘åœæ­¢ï¼Œè¿™é‡Œçš„this.dataList[old_k]._id + '' + old_kï¼Œåé¢åŠ  old_k æ˜¯ä¸ºäº†æ¯ä¸€ä¸ªè§†é¢‘çš„ id å€¼ä¸åŒï¼Œè¿™æ ·å°±å¯ä»¥å¤§ç¨‹åº¦çš„é¿å…ä¸²éŸ³é—®é¢˜
        console.log('å·²ç»æš‚åœ --> ç¬¬' + (old_k + 1) + 'ä¸ªè§†é¢‘ï½') //æç¤º
        uni.createVideoContext(this.dataList[k]._id, this).play()
        clearTimeout(this.voice)
        this.voice = setTimeout(() => {
          this.dataList[k].isplay = false
        }, 300)
        setTimeout(() => {
          this.dataList[k].playIng = true
        }, 850)
        //ã€2.0ç‰ˆæœ¬æ›´æ–°å†…å®¹ã€‘- start
        var p = k
          ++p
        setTimeout(() => {
          uni.createVideoContext(this.dataList[p]._id, this).play()
        }, 20)
        clearTimeout(this.timeout)
        this.timeout = setTimeout(() => {
          uni.createVideoContext(this.dataList[p]._id, this).seek(0)
          uni.createVideoContext(this.dataList[p]._id, this).pause()
          console.log('é¢„åŠ è½½ç¬¬' + (p + 1) + 'ä¸ªè§†é¢‘ï¼š' + this.dataList[p]._id)
        }, 1500)
        //ã€2.0ç‰ˆæœ¬æ›´æ–°å†…å®¹ã€‘- end
      }
    },
    onShow() {
      console.log('new_indexå›åˆ°å‰å°');
      this.dataList[this.k].state = 'play';
      uni.createVideoContext(this.dataList[this.k]._id, this).play()
    },
    onUnload() {
      this.dataList[this.k].state = 'pause'; //ç•Œé¢éšè—ä¹Ÿè¦åœæ­¢æ’­æ”¾è§†é¢‘
      uni.createVideoContext(this.dataList[this.k]._id, this).pause(); //æš‚åœä»¥åç»§ç»­æ’­æ”¾
      console.log('onUnload--->new_indexåˆ°åå°');
    },
    onHide() {
      this.dataList[this.k].state = 'pause'; //ç•Œé¢éšè—ä¹Ÿè¦åœæ­¢æ’­æ”¾è§†é¢‘
      uni.createVideoContext(this.dataList[this.k]._id, this).pause(); //æš‚åœä»¥åç»§ç»­æ’­æ”¾
      console.log('onHide--->new_indexåˆ°åå°');
    },
    onLoad() {
      uni.getSystemInfo({
        success: (e) => {
          this.platform = e.platform //è·å–æ“ä½œç³»ç»Ÿ
          if (e.model == 'iPhone12' || e.model == 'iPhone11' || e.model == 'iPhoneX') {
            // this.deleteHeight = 32//è¿™é‡Œçš„æ•°å€¼åªæ˜¯åšæ¨¡æ‹Ÿï¼Œå¯è‡ªè¡Œæ›´æ”¹
            this.deleteHeight = 0 //è¿™é‡Œçš„æ•°å€¼åªæ˜¯åšæ¨¡æ‹Ÿï¼Œå¯è‡ªè¡Œæ›´æ”¹
          }
        }
      })

      this.statusBarHeight = uni.getSystemInfoSync().statusBarHeight + 'px';

      this.windowWidth = uni.getSystemInfoSync().screenWidth //è·å–å±å¹•å®½åº¦
      this.boxStyle.width = this.windowWidth + 'px' //ç»™å®½åº¦åŠ px
      // this.wHeight = uni.getSystemInfoSync().screenHeight;//è·å–å±å¹•é«˜åº¦
      this.wHeight = uni.getSystemInfoSync().windowHeight; //è·å–å±å¹•å¯ç”¨é«˜åº¦
      console.log('å±å¹•é«˜åº¦wHeightï¼š', this.wHeight)
      this.boxStyle.height = this.wHeight - this.deleteHeight; //å¯ä»¥è‡ªè¡Œæ›´æ”¹è§†é¢‘é«˜åº¦ï¼Œæƒ³è§†é¢‘ä¸é‚£ä¹ˆé«˜ï¼Œå°±æŠŠ0æ”¹å¤§ä¸€ç‚¹
      this.ready = true;
      this.username = uni.getStorageSync('username')
      this.get() //è¿™ä¸€æ­¥ï¼ŒåŠ è½½è§†é¢‘æ•°æ®
    },
    onReady() {},
    methods: {
      toTwoVideo() {
        uni.navigateTo({
          url: '../new_index/new_index'
        })
      },
      tolistVideo() {
        uni.navigateTo({
          url: '../nvueSwiper/nvueSwiper'
        })
      },
      getData() {
        var msg = userList
        for (let i = 0; i < 10; i++) {
          this.dataList.push(msg[i])
        }
      },
      touchstart(event) {
        this.dataList[this.k].isShowimage = true //åˆšè§¦æ‘¸çš„æ—¶å€™å°±è¦æ˜¾ç¤ºé¢„è§ˆè§†é¢‘å›¾ç‰‡äº†
        this.dataList[this.k].isShowProgressBarTime = true //æ˜¾ç¤ºæ—¶é—´çº¿
        this.ProgressBarOpacity = 1 //è®©æ»‘å—æ˜¾ç¤ºèµ·æ¥æ›´æ˜æ˜¾ä¸€ç‚¹
        this.dotWidth = 10 //è®©ç‚¹æ˜¾ç¤ºèµ·æ¥æ›´æ˜æ˜¾ä¸€ç‚¹
      },
      touchend() { //å½“æ‰‹æ¾å¼€åï¼Œè·³åˆ°æœ€æ–°æ—¶é—´
        uni.createVideoContext(this.dataList[this.k]._id, this).seek(this.newTime)
        if (this.dataList[this.k].state == 'pause') {
          this.dataList[this.k].state = 'play'
          uni.createVideoContext(this.dataList[this.k]._id, this).play()
        }
        this.dataList[this.k].isShowProgressBarTime = false //è§¦æ‘¸ç»“æŸåï¼Œéšè—æ—¶é—´çº¿
        this.dataList[this.k].isShowimage = false //è§¦æ‘¸ç»“æŸåï¼Œéšè—æ—¶é—´é¢„è§ˆ
        this.ProgressBarOpacity = 0.5 //éšè—èµ·æ¥è¿›åº¦æ¡ï¼Œä¸é‚£ä¹ˆæ˜æ˜¾äº†
        this.dotWidth = 0 //éšè—èµ·æ¥è¿›åº¦æ¡ï¼Œä¸é‚£ä¹ˆæ˜æ˜¾äº†
      },
      touchmove(event) { //å½“æ‰‹ç§»åŠ¨æ»‘å—æ—¶ï¼Œè®¡ç®—ä½ç½®ã€ç™¾åˆ†å°æ•°ã€æ–°çš„æ—¶é—´
        var msg = []
        if (this.videoTime !== '') {
          msg = this.videoTime.split(':')
        }
        var timeNumber = Number(msg[0]) * 60 + Number(msg[1])
        this.currentPositions = event.changedTouches[0].screenX
        this.percent = this.currentPositions / this.windowWidth
        this.newTime = this.percent * timeNumber
        this.currenttimes = parseInt(this.newTime)
        let theTime = this.newTime
        let middle = 0; // åˆ†
        if (theTime > 60) {
          middle = parseInt(theTime / 60);
          theTime = parseInt(theTime % 60);
        }
        this.changeTime =
          `${Math.round(middle)>9?Math.round(middle):'0'+Math.round(middle)}:${Math.round(theTime)>9?Math.round(theTime):'0'+Math.round(theTime)}`
      },
      timeupdate(event, index) { //è®¡ç®—æ»‘å—å½“å‰ä½ç½®ï¼Œè®¡ç®—å½“å‰ç™¾åˆ†å°æ•°
        // console.log(index)
        if (index == this.k) {
          // console.log(event)
          var currenttime = event.detail.currentTime
          this.timeNumber = Math.round(event.detail.duration)
          this.getTime()
          this.percent = currenttime / this.timeNumber
          this.currentPosition = this.windowWidth * this.percent
          let theTime = currenttime
          let middle = 0; // åˆ†
          if (theTime > 60) {
            middle = parseInt(theTime / 60);
            theTime = parseInt(theTime % 60);
          }
          this.changeTime =
            `${Math.round(middle)>9?Math.round(middle):'0'+Math.round(middle)}:${Math.round(theTime)>9?Math.round(theTime):'0'+Math.round(theTime)}`
          //è‡ªåŠ¨åˆ‡æ¢è§†é¢‘
          // if (currenttime == this.timeNumber - 1) {
          //   const dom = uni.requireNativePlugin('dom')
          //   let doms = 'item' + (this.k + 1)
          //   setTimeout(() => {
          //     let el = this.$refs[doms][0]
          //     dom.scrollToElement(el, {
          //       offset: 0,
          //       animated: true
          //     })
          //   }, 500)
          // }
        }
      },
      getTime() { //å¾—åˆ°æ—¶é—´å‡½æ•°
        this.videoTime = this.formatSeconds(this.timeNumber);
        // console.log(that.videoTime)
        var msg = []
        if (this.videoTime !== '') {
          msg = this.videoTime.split(':')
        }
        this.videoTimes = `${msg[0]>9?msg[0]:'0'+msg[0]}:${msg[1]>9?msg[1]:'0'+msg[1]}`;
      },
      formatSeconds(value) { //è·å–æ—¶é—´å‡½æ•°
        let theTime = parseInt(value); // ç§’
        let middle = 0; // åˆ†
        if (theTime > 60) {
          middle = parseInt(theTime / 60);
          theTime = parseInt(theTime % 60);
        }
        return `${middle>9?middle:middle}:${theTime>9?theTime:theTime}`;
      },
      playIngs(index) {
        //
      },
      moreVideo(index) {

      },
      toVideo(index) {

      },
      erweima() {

      },
      tozuozhe() {
        this.currents = 1 //ç‚¹å‡»å¤´åƒä»¥åå°±ä¼šåˆ‡æ¢
      },
      stop() {
        // console.log('stop')
      },
      scrolls(event) {
        this.isDragging = event.isDragging
        if (!event.isDragging) { //isDraggingï¼šåˆ¤æ–­ç”¨æˆ·æ˜¯ä¸æ˜¯åœ¨æ»‘åŠ¨ï¼Œæ»‘åŠ¨ï¼štrueï¼Œåœæ­¢æ»‘åŠ¨ï¼šfalseã€‚æˆ‘ä»¬è¦ç”¨æˆ·åœæ­¢æ»‘åŠ¨æ—¶æ‰ç»™ k èµ‹å€¼ï¼Œè¿™æ ·å°±å¯ä»¥é¿å…å¾ˆå¤šéº»çƒ¦
          var i = Math.round(Math.abs(event.contentOffset.y) / (this.wHeight - this.deleteHeight +
            1)) //å…ˆç”¨ç»å¯¹å€¼å–å‡ºæ»‘åŠ¨çš„è·ç¦»ï¼Œç„¶åé™¤ä»¥å±å¹•é«˜åº¦ï¼Œå–ä¸€ä¸ªæ•´ï¼Œå°±çŸ¥é“ä½ ç°åœ¨æ»‘åŠ¨åˆ°å“ªä¸€ä¸ªè§†é¢‘äº†
          if (i !== this.k) { //è¿™é‡ŒåŠ åˆ¤æ–­æ˜¯å› ä¸ºè¿™ä¸ªæ–¹æ³•ä¼šæ‰§è¡Œå¾ˆå¤šæ¬¡ï¼Œä¼šé€ æˆé‡å¤è¯·æ±‚ï¼Œæ‰€ä»¥è¿™é‡Œå†™ä¸€ä¸ªé™åˆ¶
            this.k = i //åˆ¤æ–­äº†ç”¨æˆ·æ²¡æœ‰æ»‘åŠ¨ï¼Œç¡®è®¤äº†ç”¨æˆ·çš„ç¡®æ˜¯åœ¨çœ‹è¿™ä¸ªè§†é¢‘ï¼Œç„¶åå°±èµ‹å€¼å•¦
            this.dataList[this.k].state = 'play'
            console.log('æ­£åœ¨æ’­æ”¾ --> ç¬¬' + (this.k + 1) + 'ä¸ªè§†é¢‘ï½')
          }
        }
      },
      get() {
        // è¿™ä¸ªæ–¹æ³•ä¸»è¦å°±æ˜¯ç”¨æ¥ç¬¬ä¸€æ¬¡è¿›å…¥è§†é¢‘æ’­æ”¾æ—¶ç”¨æ¥å¤„ç†çš„
        this.dataList = userList; //è¿™ä¸ªå°±æ˜¯èµ‹å€¼åŠ è½½è§†é¢‘å•¦
        this.dataList[0].state = "play";
        setTimeout(() => {
          //è¿™é‡Œçš„å»¶è¿Ÿæ˜¯ä¸ºäº†é¿å…æ‰§è¡Œæ—¶é—´å¤ªå¿«è€Œç›´æ¥è·³è¿‡æ‰§è¡Œçš„ bug
          uni.createVideoContext(this.dataList[0]._id, this).seek(0)
          uni.createVideoContext(this.dataList[0]._id, this).play()
        }, 200)
        this.dataList[this.k].isplay = false
        setTimeout(() => {
          this.dataList[this.k].playIng = true
        }, 500)
        var p = 0
        setTimeout(() => {
          ++p
          uni.createVideoContext(this.dataList[p]._id, this).play()
          setTimeout(() => {
            uni.createVideoContext(this.dataList[p]._id, this).seek(0)
            uni.createVideoContext(this.dataList[p]._id, this).pause()
            console.log('é¢„åŠ è½½ç¬¬' + (p + 1) + 'ä¸ªè§†é¢‘ï¼š' + this.dataList[p]._id)
          }, 2000)
        }, 50)
      },
      onpullingdown() {
        // console.log('æ­£åœ¨ä¸‹æ‹‰åˆ·æ–°ï¼Œæ­¤æ—¶æ‰‹è¿˜åœ¨è§¦æ‘¸æ²¡æœ‰æ¾å¼€')
        this.refreshing = true
      },
      onrefresh() {
        // console.log('ä¸‹æ‹‰åˆ·æ–°å®Œæ¯•ï¼Œæ­¤æ—¶æ‰‹æ¾å¼€äº†')
        setTimeout(() => {
          this.refreshing = false
        }, 1000)
      },
      //ç‚¹å‡»æ’­æ”¾&&æš‚åœ
      tapVideoHover(state, event) {
        this.dataList[this.k].isShowimage = false
        this.dataList[this.k].isShowProgressBarTime = false
        this.ProgressBarOpacity = 0.5
        this.dotWidth = 0
        console.log('state--', state);
        if (state == 'play' || state == 'continue') {
          this.dataList[this.k].state = 'pause';
        } else {
          this.dataList[this.k].state = 'continue';
        }
        if (this.dataList[this.k].state == 'continue') {
          uni.createVideoContext(this.dataList[this.k]._id, this).play(); //æš‚åœä»¥åç»§ç»­æ’­æ”¾
        }
        if (this.dataList[this.k].state == 'pause') {
          uni.createVideoContext(this.dataList[this.k]._id, this).pause(); //æš‚åœä»¥åç»§ç»­æ’­æ”¾
        }
      },
      toComment() {

      },
      share() {

      },
      cLike(sss) {
        this.dataList[this.k].like = !this.dataList[this.k].like
        const video = this.dataList[this.k];
        sss ? video.like_n -= 1 : video.like_n += 1;
        /*
        è¿™é‡Œæˆ‘ä»‹ç»ä¸€ç§æˆ‘åœ¨çœŸå®æ•°æ®çš„å¸¸ç”¨åŠæ³•ï¼š
        jsé‡Œé¢æœ‰ä¸€ä¸ªæ–¹æ³•å«åš indexOf() è¿™ä¸ªæ–¹æ³•å¾ˆæœ‰ç”¨ï¼Œå…å»äº†å†™ for å¾ªç¯
        	ï¼ˆè¿™é‡Œæ’ä¸€å¥ï¼šfor å¾ªç¯çš„æ•ˆç‡è¦æ¯”å…¶ä»–çš„ ä¾‹å¦‚ï¼šforEachã€map æ•ˆç‡è¦é«˜ï¼‰
        çœŸå®æ•°æ®ä¸€èˆ¬æ˜¯è¿”å›ä¸€ä¸ªè§†é¢‘çš„å¤§æ•°ç»„ï¼Œç„¶åè§†é¢‘é‡Œçš„å‚æ•°æœ‰ä¸€ä¸ªå‚æ•°å°±æ˜¯ like å‚æ•°ï¼Œ
        æŠŠ like å‚æ•°è®¾ç½®æˆæ•°ç»„ï¼Œç„¶åç‚¹èµå°±æŠŠåå­—æ·»åŠ è¿›å»ã€‚ä¹Ÿå°±æ˜¯åœ¨åç«¯å­˜å‚¨ä¸‹æ¥çš„æ•°æ®ï¼Œ
        å®é™…ä¸Šæ˜¯ä¸€ä¸ªæ•°ç»„ã€‚å½“æ¸²æŸ“åˆ°å‰ç«¯é¡µé¢æ—¶ï¼Œæˆ‘ä»¬å°±æŠŠæ¯ä¸€ä¸ªè§†é¢‘æ•°æ®æ‹¿è¿‡æ¥ï¼Œåšä¸€ä¸ªåˆ¤æ–­
        å¦‚æœï¼Œlikeæ•°ç»„é‡Œæœ‰è‡ªå·±ï¼Œé‚£ä¹ˆå°±æŠŠlikeå€¼è®¾ç½®ä¸º 1 ï¼Œè¡¨ç¤ºè‡ªå·±å·²ç»ç‚¹èµï¼Œå¦‚æœæ²¡æœ‰
        è‡ªå·±å°±è®¾ç½®ä¸º 0 
        */
      }
    }
  }
</script>
<style>
  .top_nav {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    background-image: linear-gradient(to bottom, rgba(0, 0, 0, 0.6), rgba(0, 0, 0, 0));
  }

  .top_nav .top_content {
    padding-top: 30upx;
    flex-direction: row;
    align-items: center;
    justify-content: center;
  }

  .top_nav .top_content .player {
    position: absolute;
    left: 20px;
    top: 35upx;
  }

  .top_nav .top_content .img {
    width: 44upx;
    height: 44upx;
  }

  .top_nav .top_content .content_btn {
    flex-direction: row;
    width: 140px;
    align-items: center;
    justify-content: space-around;
  }

  .top_nav .top_content .content_btn .content_item {
    position: relative;
    height: 30px;
  }

  .top_nav .top_content .content_btn .content_item .line_on {
    position: absolute;
    width: 30px;
    height: 2px;
    background-color: #FFFFFF;
    bottom: 0;
    left: 2px;
    border-radius: 4upx;
  }

  .top_nav .top_content .content_btn .content_item .item_title {
    color: #dcdcdc;
    font-size: 36upx;
    font-weight: bold;
  }

  .top_nav .top_content .content_btn .content_item .i_on {
    font-weight: bold;
    font-size: 38upx;
    color: #FFFFFF !important;
  }

  .top_nav .top_content .search {
    position: absolute;
    right: 20px;
    top: 35upx;
  }



  .container {
    background-color: #000000;
  }

  .item {
    /* width : 750rpx; */
    background-color: #000000;
    position: relative;
  }

  .videoHover {
    position: absolute;
    top: 0;
    left: 0;
    flex: 1;
    background-color: rgba(0, 0, 0, 0.1);
    justify-content: center;
    align-items: center;

    /* border-style: dashed;
		border-color: #DD524D;
		border-width: 1px; */
  }

  .playState {
    width: 160rpx;
    height: 160rpx;
    opacity: 0.2;
  }

  .userInfo {
    position: absolute;
    bottom: 110px;
    right: 10px;
    flex-direction: column;

  }

  .userAvatar {
    border-radius: 500%;
    margin-bottom: 15px;
    border-style: solid;
    border-width: 2px;
    border-color: #ffffff;
  }

  .userAvatar {
    width: 100rpx;
    height: 100rpx;
  }

  .likeIco,
  .shareIco,
  .commentIco {
    width: 60rpx;
    height: 60rpx;
    margin-top: 15px;
  }

  .likeNum,
  .commentNum,
  .shareTex {
    color: #ffffff;
    font-size: 30rpx;
    text-align: center;
    margin: 5px;
  }

  .likeNumActive {
    color: red;
  }

  .content {
    width: 720rpx;
    z-index: 99;
    position: absolute;
    bottom: 30px;
    /* justify-content: center; */
    padding: 15rpx;
    flex-direction: column;
    justify-content: flex-start;
    color: #ffffff;
  }

  .userName {
    font-size: 30rpx;
    color: #ffffff;
    margin-top: 80upx;
  }

  .words {
    margin-top: 10rpx;
    font-size: 30rpx;
    color: #ffffff;

    overflow: hidden;
    text-overflow: ellipsis;
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
  }

  .root {
    background-color: #000000;
  }
</style>
